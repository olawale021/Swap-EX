Scenario Flow
1. User Registration and Item Listing
* User Registration: Users register on the platform by providing their username, phone number, password, and address.
INSERT INTO users (username, phone_number, password, address)
* VALUES ('john_doe', 1234567890, 'password123', '{"street": "123 Main St", "city": "Anytown", "country": "USA", "zipcode": 12345}');
* 
* Item Listing: User John lists an item for exchange. Let's say it's a smartphone under the category "electronics".
INSERT INTO items (user_id, category_id, description, condition, photos)
* VALUES (1, 1, 'Smartphone, model XYZ, 128GB, black', 'Excellent', '["url1", "url2"]');
* 
Browsing and Showing Interest

Browsing Items: Other users browse the items listed. User Jane finds John's smartphone listing interesting.

Expressing Interest: Jane expresses interest in the smartphone. At this stage, an exchange record is created with a pending status,
and Jane sends her first message along with her interest. This step involves two sub-steps:

Create Exchange Record:


INSERT INTO exchanges (item_id, interested_user_id, status)
VALUES (1, 2, 'pending');
Retrieve Exchange ID:



SELECT id FROM exchanges WHERE item_id = 1 AND interested_user_id = 2 AND status = 'pending';
Send Initial Message:


INSERT INTO messages (exchange_id, sender_id, receiver_id, content)
VALUES (1, 2, 1, 'Interested in exchanging my tablet for your smartphone');
Communication and Negotiation

Messages Exchange: John and Jane exchange messages to negotiate the details of the exchange.

INSERT INTO messages (exchange_id, sender_id, receiver_id, content)
VALUES (1, 1, 2, 'I am interested in your tablet, can you share more details?');

INSERT INTO messages (exchange_id, sender_id, receiver_id, content)
VALUES (1, 2, 1, 'Sure, it’s in great condition and comes with a cover.');
Finalizing the Exchange

Updating the Exchange: Once both parties agree, the exchange status is updated.

UPDATE exchanges
SET status = 'confirmed'
WHERE id = 1;

UPDATE exchanges
SET status = 'completed'
WHERE id = 1;
Adjusted Example Walkthrough
User Registration:


INSERT INTO users (username, phone_number, password, address)
VALUES ('john_doe', 1234567890, 'password123', '{"street": "123 Main St", "city": "Anytown", "country": "USA", "zipcode": 12345}');
Item Listing:


INSERT INTO items (user_id, category_id, description, condition, photos)
VALUES (1, 1, 'Smartphone, model XYZ, 128GB, black', 'Excellent', '["url1", "url2"]');
Jane Shows Interest:

Create Exchange Record:


INSERT INTO exchanges (item_id, interested_user_id, status)
VALUES (1, 2, 'pending');
Retrieve Exchange ID:


SELECT id FROM exchanges WHERE item_id = 1 AND interested_user_id = 2 AND status = 'pending';
Send Initial Message:


INSERT INTO messages (exchange_id, sender_id, receiver_id, content)
VALUES (1, 2, 1, 'Interested in exchanging my tablet for your smartphone');
Negotiation Messages:


INSERT INTO messages (exchange_id, sender_id, receiver_id, content)
VALUES (1, 1, 2, 'I am interested in your tablet, can you share more details?');

INSERT INTO messages (exchange_id, sender_id, receiver_id, content)
VALUES (1, 2, 1, 'Sure, it’s in great condition and comes with a cover.');
Finalizing the Exchange:

Confirm Exchange:


UPDATE exchanges
SET status = 'confirmed'
WHERE id = 1;
Complete Exchange:


UPDATE exchanges
SET status = 'completed'
WHERE id = 1;
By following this adjusted flow, you ensure that the exchange ID is created and available before the initial message is sent,
allowing for proper tracking and referencing throughout the exchange process.